# 旅游助手Web应用 - 数据库设计文档

## 1. 数据库概述

### 1.1 数据库选择
- **数据库类型**: PostgreSQL 15
- **选择理由**: 
  - 支持JSON字段，适合存储复杂的行程数据
  - 强大的查询能力和索引支持
  - 开源免费，适合课程作业
  - 支持事务和并发控制

### 1.2 数据库设计原则
- 遵循第三范式，减少数据冗余
- 合理使用JSON字段存储非结构化数据
- 建立适当的索引提升查询性能
- 使用外键约束保证数据完整性
- 考虑数据扩展性和维护性

## 2. 核心表结构设计

### 2.1 用户表 (users)
```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(500),
    phone VARCHAR(20),
    preferences JSONB DEFAULT '{}',
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    email_verified BOOLEAN DEFAULT FALSE,
    last_login_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_created_at ON users(created_at);

-- 注释
COMMENT ON TABLE users IS '用户基本信息表';
COMMENT ON COLUMN users.preferences IS '用户偏好设置，JSON格式';
COMMENT ON COLUMN users.status IS '用户状态：active-活跃，inactive-非活跃，suspended-暂停';
```

### 2.2 行程表 (trips)
```sql
CREATE TABLE trips (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(200) NOT NULL,
    destination VARCHAR(100) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    budget DECIMAL(12,2),
    actual_cost DECIMAL(12,2) DEFAULT 0,
    travelers_count INTEGER DEFAULT 1 CHECK (travelers_count > 0),
    preferences JSONB DEFAULT '{}',
    status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'planning', 'active', 'completed', 'cancelled')),
    cover_image_url VARCHAR(500),
    description TEXT,
    tags TEXT[],
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_trips_user_id ON trips(user_id);
CREATE INDEX idx_trips_dates ON trips(start_date, end_date);
CREATE INDEX idx_trips_status ON trips(status);
CREATE INDEX idx_trips_destination ON trips(destination);
CREATE INDEX idx_trips_created_at ON trips(created_at);
CREATE INDEX idx_trips_budget ON trips(budget);

-- 注释
COMMENT ON TABLE trips IS '行程基本信息表';
COMMENT ON COLUMN trips.preferences IS '行程偏好设置，包含兴趣、住宿类型等';
COMMENT ON COLUMN trips.tags IS '行程标签数组';
COMMENT ON COLUMN trips.status IS '行程状态：draft-草稿，planning-规划中，active-进行中，completed-已完成，cancelled-已取消';
```

### 2.3 行程详情表 (trip_details)
```sql
CREATE TABLE trip_details (
    id BIGSERIAL PRIMARY KEY,
    trip_id BIGINT NOT NULL REFERENCES trips(id) ON DELETE CASCADE,
    day_number INTEGER NOT NULL CHECK (day_number > 0),
    date DATE NOT NULL,
    activities JSONB NOT NULL DEFAULT '[]',
    accommodation JSONB,
    transportation JSONB,
    meals JSONB DEFAULT '[]',
    notes TEXT,
    weather JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(trip_id, day_number)
);

-- 索引
CREATE INDEX idx_trip_details_trip_id ON trip_details(trip_id);
CREATE INDEX idx_trip_details_date ON trip_details(date);
CREATE INDEX idx_trip_details_day_number ON trip_details(day_number);

-- 注释
COMMENT ON TABLE trip_details IS '行程详细安排表';
COMMENT ON COLUMN trip_details.activities IS '当日活动安排，JSON数组格式';
COMMENT ON COLUMN trip_details.accommodation IS '住宿信息，JSON格式';
COMMENT ON COLUMN trip_details.transportation IS '交通信息，JSON格式';
COMMENT ON COLUMN trip_details.meals IS '餐饮安排，JSON数组格式';
COMMENT ON COLUMN trip_details.weather IS '天气信息，JSON格式';
```

### 2.4 费用记录表 (expenses)
```sql
CREATE TABLE expenses (
    id BIGSERIAL PRIMARY KEY,
    trip_id BIGINT NOT NULL REFERENCES trips(id) ON DELETE CASCADE,
    trip_detail_id BIGINT REFERENCES trip_details(id) ON DELETE SET NULL,
    category VARCHAR(50) NOT NULL CHECK (category IN ('transportation', 'accommodation', 'meal', 'activity', 'shopping', 'other')),
    subcategory VARCHAR(50),
    amount DECIMAL(12,2) NOT NULL CHECK (amount >= 0),
    currency VARCHAR(3) DEFAULT 'CNY',
    description TEXT,
    date DATE NOT NULL,
    location VARCHAR(200),
    coordinates JSONB,
    receipt_url VARCHAR(500),
    tags TEXT[],
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_expenses_trip_id ON expenses(trip_id);
CREATE INDEX idx_expenses_trip_detail_id ON expenses(trip_detail_id);
CREATE INDEX idx_expenses_date ON expenses(date);
CREATE INDEX idx_expenses_category ON expenses(category);
CREATE INDEX idx_expenses_amount ON expenses(amount);

-- 注释
COMMENT ON TABLE expenses IS '费用记录表';
COMMENT ON COLUMN expenses.category IS '费用类别：transportation-交通，accommodation-住宿，meal-餐饮，activity-活动，shopping-购物，other-其他';
COMMENT ON COLUMN expenses.coordinates IS '费用发生地坐标，JSON格式';
COMMENT ON COLUMN expenses.receipt_url IS '收据图片URL';
```

### 2.5 地点信息表 (pois)
```sql
CREATE TABLE pois (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    name_en VARCHAR(200),
    category VARCHAR(50) NOT NULL,
    subcategory VARCHAR(50),
    address TEXT,
    city VARCHAR(100),
    country VARCHAR(100),
    coordinates JSONB NOT NULL,
    rating DECIMAL(3,2) CHECK (rating >= 0 AND rating <= 5),
    price_range VARCHAR(20),
    opening_hours JSONB,
    contact_info JSONB,
    description TEXT,
    images TEXT[],
    tags TEXT[],
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_pois_name ON pois(name);
CREATE INDEX idx_pois_category ON pois(category);
CREATE INDEX idx_pois_city ON pois(city);
CREATE INDEX idx_pois_coordinates ON pois USING GIST ((coordinates::geometry));
CREATE INDEX idx_pois_rating ON pois(rating);
CREATE INDEX idx_pois_is_active ON pois(is_active);

-- 注释
COMMENT ON TABLE pois IS '兴趣点信息表';
COMMENT ON COLUMN pois.coordinates IS '地理坐标，JSON格式：{"lat": 35.6762, "lng": 139.6503}';
COMMENT ON COLUMN pois.opening_hours IS '营业时间，JSON格式';
COMMENT ON COLUMN pois.contact_info IS '联系信息，JSON格式';
```

### 2.6 用户收藏表 (user_favorites)
```sql
CREATE TABLE user_favorites (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    poi_id BIGINT REFERENCES pois(id) ON DELETE CASCADE,
    trip_id BIGINT REFERENCES trips(id) ON DELETE CASCADE,
    type VARCHAR(20) NOT NULL CHECK (type IN ('poi', 'trip')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, poi_id, type),
    UNIQUE(user_id, trip_id, type)
);

-- 索引
CREATE INDEX idx_user_favorites_user_id ON user_favorites(user_id);
CREATE INDEX idx_user_favorites_poi_id ON user_favorites(poi_id);
CREATE INDEX idx_user_favorites_trip_id ON user_favorites(trip_id);
CREATE INDEX idx_user_favorites_type ON user_favorites(type);

-- 注释
COMMENT ON TABLE user_favorites IS '用户收藏表';
COMMENT ON COLUMN user_favorites.type IS '收藏类型：poi-兴趣点，trip-行程';
```

### 2.7 行程分享表 (trip_shares)
```sql
CREATE TABLE trip_shares (
    id BIGSERIAL PRIMARY KEY,
    trip_id BIGINT NOT NULL REFERENCES trips(id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    share_code VARCHAR(20) UNIQUE NOT NULL,
    is_public BOOLEAN DEFAULT FALSE,
    expires_at TIMESTAMP,
    view_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_trip_shares_trip_id ON trip_shares(trip_id);
CREATE INDEX idx_trip_shares_user_id ON trip_shares(user_id);
CREATE INDEX idx_trip_shares_share_code ON trip_shares(share_code);
CREATE INDEX idx_trip_shares_is_public ON trip_shares(is_public);

-- 注释
COMMENT ON TABLE trip_shares IS '行程分享表';
COMMENT ON COLUMN trip_shares.share_code IS '分享码，用于公开访问';
```

### 2.8 系统配置表 (system_configs)
```sql
CREATE TABLE system_configs (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    config_key VARCHAR(100) NOT NULL,
    config_value TEXT,
    config_type VARCHAR(20) DEFAULT 'string' CHECK (config_type IN ('string', 'number', 'boolean', 'json')),
    description TEXT,
    is_public BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, config_key)
);

-- 索引
CREATE INDEX idx_system_configs_user_id ON system_configs(user_id);
CREATE INDEX idx_system_configs_key ON system_configs(config_key);
CREATE INDEX idx_system_configs_is_public ON system_configs(is_public);

-- 注释
COMMENT ON TABLE system_configs IS '系统配置表';
COMMENT ON COLUMN system_configs.config_type IS '配置值类型：string-字符串，number-数字，boolean-布尔值，json-JSON对象';
```

## 3. JSON字段详细设计

### 3.1 用户偏好设置 (users.preferences)
```json
{
    "language": "zh-CN",
    "currency": "CNY",
    "theme": "light",
    "notifications": {
        "email": true,
        "push": true,
        "sms": false
    },
    "privacy": {
        "profile_public": false,
        "trip_public": false
    },
    "travel_preferences": {
        "accommodation_type": "hotel",
        "transportation_preference": "public",
        "dining_preference": "local",
        "activity_level": "moderate"
    }
}
```

### 3.2 行程偏好设置 (trips.preferences)
```json
{
    "interests": ["美食", "文化", "自然风光", "购物"],
    "accommodation": {
        "type": "hotel",
        "budget_range": "mid-range",
        "amenities": ["WiFi", "早餐", "健身房"]
    },
    "transportation": {
        "preference": "public",
        "budget_range": "economy"
    },
    "dining": {
        "preference": "local",
        "budget_range": "mid-range",
        "dietary_requirements": []
    },
    "activities": {
        "preference": "cultural",
        "intensity": "moderate",
        "group_size": "small"
    },
    "special_requirements": {
        "accessibility": false,
        "child_friendly": true,
        "pet_friendly": false
    }
}
```

### 3.3 活动安排 (trip_details.activities)
```json
[
    {
        "id": "act_001",
        "time": "09:00",
        "type": "transportation",
        "title": "抵达东京",
        "description": "成田机场到达，乘坐机场快线到市区",
        "location": "成田机场",
        "coordinates": {
            "lat": 35.7720,
            "lng": 140.3928
        },
        "duration": 120,
        "cost": 0,
        "tips": "建议提前预订机场快线票",
        "booking_info": {
            "provider": "JR East",
            "booking_url": "https://example.com",
            "confirmation_number": "ABC123"
        }
    },
    {
        "id": "act_002",
        "time": "12:00",
        "type": "meal",
        "title": "午餐 - 拉面",
        "description": "品尝正宗日式拉面",
        "location": "新宿拉面店",
        "coordinates": {
            "lat": 35.6909,
            "lng": 139.7003
        },
        "duration": 60,
        "cost": 50.00,
        "tips": "推荐豚骨拉面",
        "menu_items": ["豚骨拉面", "味噌拉面", "酱油拉面"]
    }
]
```

### 3.4 住宿信息 (trip_details.accommodation)
```json
{
    "name": "东京酒店",
    "address": "东京都中央区",
    "coordinates": {
        "lat": 35.6762,
        "lng": 139.6503
    },
    "check_in": "15:00",
    "check_out": "11:00",
    "cost": 500.00,
    "rating": 4.5,
    "amenities": ["WiFi", "早餐", "健身房", "游泳池"],
    "room_type": "标准双人间",
    "booking_info": {
        "provider": "Booking.com",
        "booking_url": "https://example.com",
        "confirmation_number": "BK123456"
    },
    "contact": {
        "phone": "+81-3-1234-5678",
        "email": "info@tokyohotel.com"
    }
}
```

### 3.5 交通信息 (trip_details.transportation)
```json
{
    "type": "flight",
    "departure": {
        "location": "北京首都国际机场",
        "time": "08:00",
        "terminal": "T3"
    },
    "arrival": {
        "location": "成田机场",
        "time": "12:00",
        "terminal": "T1"
    },
    "airline": "中国国际航空",
    "flight_number": "CA925",
    "duration": 240,
    "cost": 2500.00,
    "booking_info": {
        "provider": "中国国航",
        "booking_url": "https://example.com",
        "confirmation_number": "CA925123"
    }
}
```

### 3.6 餐饮安排 (trip_details.meals)
```json
[
    {
        "time": "12:00",
        "type": "lunch",
        "name": "拉面",
        "location": "新宿拉面店",
        "coordinates": {
            "lat": 35.6909,
            "lng": 139.7003
        },
        "cost": 50.00,
        "cuisine": "日式",
        "rating": 4.2,
        "menu_items": ["豚骨拉面", "味噌拉面"],
        "tips": "推荐豚骨拉面"
    },
    {
        "time": "19:00",
        "type": "dinner",
        "name": "寿司",
        "location": "银座寿司店",
        "coordinates": {
            "lat": 35.6719,
            "lng": 139.7653
        },
        "cost": 200.00,
        "cuisine": "日式",
        "rating": 4.8,
        "menu_items": ["握寿司", "卷寿司", "刺身"],
        "tips": "需要提前预订"
    }
]
```

## 4. 数据库约束和触发器

### 4.1 检查约束
```sql
-- 确保行程结束日期不早于开始日期
ALTER TABLE trips ADD CONSTRAINT chk_trips_dates 
CHECK (end_date >= start_date);

-- 确保费用金额非负
ALTER TABLE expenses ADD CONSTRAINT chk_expenses_amount 
CHECK (amount >= 0);

-- 确保评分在0-5之间
ALTER TABLE pois ADD CONSTRAINT chk_pois_rating 
CHECK (rating >= 0 AND rating <= 5);
```

### 4.2 触发器
```sql
-- 自动更新updated_at字段
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 为所有表添加更新时间触发器
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_trips_updated_at BEFORE UPDATE ON trips
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_trip_details_updated_at BEFORE UPDATE ON trip_details
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_expenses_updated_at BEFORE UPDATE ON expenses
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_pois_updated_at BEFORE UPDATE ON pois
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_system_configs_updated_at BEFORE UPDATE ON system_configs
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

## 5. 数据库初始化脚本

### 5.1 创建数据库和用户
```sql
-- 创建数据库
CREATE DATABASE travelplanner 
WITH ENCODING 'UTF8' 
LC_COLLATE 'zh_CN.UTF-8' 
LC_CTYPE 'zh_CN.UTF-8';

-- 创建用户
CREATE USER travelplanner WITH PASSWORD 'password123';

-- 授权
GRANT ALL PRIVILEGES ON DATABASE travelplanner TO travelplanner;
```

### 5.2 初始化数据
```sql
-- 插入系统配置
INSERT INTO system_configs (config_key, config_value, config_type, description, is_public) VALUES
('app_name', '旅游助手', 'string', '应用名称', true),
('app_version', '1.0.0', 'string', '应用版本', true),
('max_trip_duration', '30', 'number', '最大行程天数', true),
('supported_currencies', '["CNY", "USD", "EUR", "JPY"]', 'json', '支持的货币', true),
('supported_languages', '["zh-CN", "en-US", "ja-JP"]', 'json', '支持的语言', true);

-- 插入示例POI数据
INSERT INTO pois (name, name_en, category, subcategory, address, city, country, coordinates, rating, price_range, description, tags) VALUES
('东京塔', 'Tokyo Tower', 'landmark', 'tower', '东京都港区芝公园4-2-8', '东京', '日本', '{"lat": 35.6586, "lng": 139.7454}', 4.2, 'medium', '东京的标志性建筑，可俯瞰城市全景', ARRAY['地标', '观景台', '夜景']),
('浅草寺', 'Sensoji Temple', 'temple', 'buddhist', '东京都台东区浅草2-3-1', '东京', '日本', '{"lat": 35.7148, "lng": 139.7967}', 4.5, 'free', '东京最古老的寺庙，香火鼎盛', ARRAY['寺庙', '文化', '历史']),
('新宿御苑', 'Shinjuku Gyoen', 'park', 'garden', '东京都新宿区内藤町11', '东京', '日本', '{"lat": 35.6852, "lng": 139.7108}', 4.3, 'low', '东京著名的公园，四季景色优美', ARRAY['公园', '自然', '赏樱']);
```

## 6. 数据库性能优化

### 6.1 索引优化
```sql
-- 复合索引
CREATE INDEX idx_trips_user_status_date ON trips(user_id, status, start_date);
CREATE INDEX idx_expenses_trip_category_date ON expenses(trip_id, category, date);
CREATE INDEX idx_trip_details_trip_day ON trip_details(trip_id, day_number);

-- 部分索引
CREATE INDEX idx_active_trips ON trips(user_id, start_date) WHERE status = 'active';
CREATE INDEX idx_recent_expenses ON expenses(trip_id, date) WHERE date >= CURRENT_DATE - INTERVAL '30 days';

-- 表达式索引
CREATE INDEX idx_trips_duration ON trips((end_date - start_date));
CREATE INDEX idx_expenses_month ON expenses(EXTRACT(YEAR FROM date), EXTRACT(MONTH FROM date));
```

### 6.2 查询优化
```sql
-- 使用EXPLAIN分析查询性能
EXPLAIN (ANALYZE, BUFFERS) 
SELECT t.*, u.username 
FROM trips t 
JOIN users u ON t.user_id = u.id 
WHERE t.user_id = 1 
AND t.status = 'active' 
ORDER BY t.start_date DESC;

-- 优化JSON查询
CREATE INDEX idx_trips_preferences_interests ON trips USING GIN ((preferences->'interests'));
CREATE INDEX idx_trip_details_activities ON trip_details USING GIN (activities);
```

## 7. 数据备份和恢复

### 7.1 备份策略
```bash
#!/bin/bash
# 数据库备份脚本

BACKUP_DIR="/backup/travelplanner"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="travelplanner"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 全量备份
pg_dump -h localhost -U travelplanner -d $DB_NAME \
    --format=custom \
    --compress=9 \
    --file="$BACKUP_DIR/travelplanner_full_$DATE.backup"

# 保留最近7天的备份
find $BACKUP_DIR -name "travelplanner_full_*.backup" -mtime +7 -delete
```

### 7.2 恢复脚本
```bash
#!/bin/bash
# 数据库恢复脚本

BACKUP_FILE=$1
DB_NAME="travelplanner"

if [ -z "$BACKUP_FILE" ]; then
    echo "Usage: $0 <backup_file>"
    exit 1
fi

# 停止应用服务
systemctl stop travelplanner-backend

# 恢复数据库
pg_restore -h localhost -U travelplanner -d $DB_NAME \
    --clean \
    --if-exists \
    --no-owner \
    --no-privileges \
    $BACKUP_FILE

# 启动应用服务
systemctl start travelplanner-backend
```

## 8. 数据库监控

### 8.1 性能监控查询
```sql
-- 查看表大小
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- 查看索引使用情况
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;

-- 查看慢查询
SELECT 
    query,
    calls,
    total_time,
    mean_time,
    rows
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

### 8.2 数据统计查询
```sql
-- 用户统计
SELECT 
    COUNT(*) as total_users,
    COUNT(CASE WHEN status = 'active' THEN 1 END) as active_users,
    COUNT(CASE WHEN created_at >= CURRENT_DATE - INTERVAL '30 days' THEN 1 END) as new_users_30d
FROM users;

-- 行程统计
SELECT 
    COUNT(*) as total_trips,
    COUNT(CASE WHEN status = 'active' THEN 1 END) as active_trips,
    COUNT(CASE WHEN status = 'completed' THEN 1 END) as completed_trips,
    AVG(budget) as avg_budget,
    AVG(actual_cost) as avg_actual_cost
FROM trips;

-- 费用统计
SELECT 
    category,
    COUNT(*) as count,
    SUM(amount) as total_amount,
    AVG(amount) as avg_amount
FROM expenses
GROUP BY category
ORDER BY total_amount DESC;
```

这个数据库设计文档提供了完整的数据库结构设计，包括表结构、索引、约束、触发器、初始化脚本等，可以作为数据库开发和维护的标准参考。


