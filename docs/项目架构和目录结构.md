# TravelPlanner - 项目架构和目录结构

## 1. 项目整体结构

```
TravelPlanner/
├── README.md                    # 项目说明文档
├── docker-compose.yml          # Docker编排文件
├── build-docker.bat            # Windows构建脚本
├── build-docker.sh             # Linux/Mac构建脚本
├── env.example                  # 环境变量示例
├── backend/                    # Spring Boot后端
│   ├── src/
│   ├── pom.xml
│   ├── Dockerfile
│   └── data/                   # H2数据库文件目录
├── frontend/                   # React前端
│   ├── src/
│   ├── package.json
│   ├── Dockerfile
│   ├── nginx.conf
│   └── public/
├── docs/                       # 项目文档
│   ├── PRD.md
│   ├── 技术设计文档.md
│   ├── 数据库设计文档.md
│   ├── API接口规范文档.md
│   ├── 科大讯飞API配置指南.md
│   ├── DEPLOYMENT.md
│   ├── DEVELOPMENT.md
│   ├── LOCAL_DEVELOPMENT.md
│   └── FRONTEND_README.md
└── LICENSE                     # 开源许可证
```

## 2. 后端项目结构 (Spring Boot)

```
backend/
├── src/main/java/com/travelplanner/
│   ├── TravelPlannerApplication.java
│   ├── config/                 # 配置类
│   │   ├── SecurityConfig.java
│   │   ├── WebConfig.java
│   │   ├── PasswordConfig.java
│   │   ├── EncodingConfig.java
│   │   ├── RestTemplateConfig.java
│   │   └── GlobalExceptionHandler.java
│   ├── controller/             # REST控制器
│   │   ├── AuthController.java
│   │   ├── TravelPlanController.java
│   │   ├── ExpenseController.java
│   │   ├── AIController.java
│   │   ├── UserController.java
│   │   └── ConversationController.java
│   ├── service/                # 业务逻辑层
│   │   ├── AuthService.java
│   │   ├── UserService.java
│   │   ├── TravelPlanService.java
│   │   ├── ExpenseService.java
│   │   ├── AIService.java
│   │   └── ConversationService.java
│   ├── repository/             # 数据访问层
│   │   ├── UserRepository.java
│   │   ├── TravelPlanRepository.java
│   │   ├── ExpenseRepository.java
│   │   └── ConversationRepository.java
│   ├── entity/                 # 实体类
│   │   ├── User.java
│   │   ├── TravelPlan.java
│   │   ├── Expense.java
│   │   └── Conversation.java
│   ├── security/               # 安全相关
│   │   ├── JwtUtil.java
│   │   ├── JwtAuthenticationFilter.java
│   │   ├── CustomUserDetailsService.java
│   │   ├── JwtAuthenticationEntryPoint.java
│   │   └── AuthController.java
│   └── util/                   # 工具类
│       └── MapUtils.java
├── src/main/resources/
│   ├── application.yml         # 主配置文件
│   ├── application-h2.yml      # H2数据库配置
│   └── data.sql               # 初始化数据
├── src/test/java/              # 测试代码
│   ├── controller/
│   │   └── AuthControllerTest.java
│   └── test/
│       └── FieldExtractionTest.java
├── data/                       # H2数据库文件目录
├── pom.xml                     # Maven配置
├── Dockerfile                  # Docker镜像构建文件
└── target/                     # 编译输出目录
```

## 3. 前端项目结构 (React + TypeScript)

```
frontend/
├── src/
│   ├── components/             # 通用组件
│   │   ├── ApiKeyConfig.tsx
│   │   ├── ApiKeyTest.tsx
│   │   ├── BackToTop.js
│   │   ├── BackToTop.tsx
│   │   ├── Header.js
│   │   ├── Header.tsx
│   │   ├── ProtectedRoute.js
│   │   ├── ProtectedRoute.tsx
│   │   ├── VoiceConfigModal.tsx
│   │   └── VoiceRecorder.js
│   ├── pages/                  # 页面组件
│   │   ├── BudgetAnalysisPage.tsx
│   │   ├── ChatPage.js
│   │   ├── ChatPage.tsx
│   │   ├── DashboardPage.js
│   │   ├── DemoPage.tsx
│   │   ├── ExpenseManagementPage.js
│   │   ├── ExpenseManagementPage.tsx
│   │   ├── HomePage.tsx
│   │   ├── LoginPage.js
│   │   ├── LoginPage.tsx
│   │   ├── PlanDetailPage.js
│   │   ├── PlanDetailPage.tsx
│   │   ├── ProfilePage.js
│   │   ├── ProfilePage.tsx
│   │   ├── RegisterPage.js
│   │   ├── RegisterPage.tsx
│   │   ├── SettingsPage.tsx
│   │   └── TravelPlansPage.tsx
│   ├── services/               # API服务
│   │   ├── api.js
│   │   └── api.ts
│   ├── types/                  # TypeScript类型定义
│   │   ├── index.ts
│   │   └── speech.d.ts
│   ├── contexts/               # React Context
│   │   ├── AuthContext.js
│   │   └── AuthContext.tsx
│   ├── hooks/                   # 自定义Hooks
│   │   ├── useVoiceRecognition.js
│   │   ├── useVoiceRecorder.js
│   │   └── useVoiceRecorder.ts
│   ├── utils/                   # 工具函数
│   │   └── index.js
│   ├── App.css
│   ├── App.js
│   ├── index.css
│   ├── index.js
│   └── index.tsx
├── public/
│   └── index.html
├── build/                      # 构建输出目录
├── package.json                # 依赖配置
├── package-lock.json           # 依赖锁定文件
├── tsconfig.json               # TypeScript配置
├── Dockerfile                  # Docker镜像构建文件
├── nginx.conf                  # Nginx配置
└── index.html                  # HTML模板
```

## 4. 配置文件结构

### 4.1 后端配置文件

#### application.yml (主配置)
```yaml
server:
  port: 8080
  servlet:
    context-path: /api
    encoding:
      charset: UTF-8
      enabled: true
      force: true

spring:
  application:
    name: travel-planner
  
  # 数据库配置 - H2内存数据库（开发/默认）
  datasource:
    url: jdbc:h2:mem:travel_planner;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: 
    driver-class-name: org.h2.Driver
    
  # JPA配置
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
    defer-datasource-initialization: true
    
  # SQL初始化配置
  sql:
    init:
      mode: always
      continue-on-error: false
        
  # Jackson配置
  jackson:
    time-zone: Asia/Shanghai
    date-format: yyyy-MM-dd HH:mm:ss
    serialization:
      write-dates-as-timestamps: false

# 日志配置
logging:
  level:
    com.travelplanner: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 自定义配置
app:
  # JWT配置
  jwt:
    secret: ${JWT_SECRET:travelplanner-secret-key-2024-very-secure-jwt-token-for-hs512-algorithm-must-be-at-least-512-bits-long}
    expiration: 86400000 # 24小时
    
  # 百度地图API配置
  baidu:
    api-key: ${BAIDU_API_KEY:your_baidu_api_key}
    base-url: https://api.map.baidu.com
    
  # 科大讯飞API配置
  xunfei:
    app-id: ${XUNFEI_APP_ID:your_xunfei_app_id}
    api-key: ${XUNFEI_API_KEY:your_xunfei_api_key}
    api-secret: ${XUNFEI_API_SECRET:your_xunfei_api_secret}
    base-url: https://api.xf-yun.com/v1/private
    
  # 阿里通义千问API配置
  qwen:
    api-key: ${QWEN_API_KEY:}
    base-url: https://dashscope.aliyuncs.com/api/v1
    model: qwen-turbo
    
  # AI服务配置
  ai:
    mock-mode: false
```

### 4.2 前端配置文件

#### package.json
```json
{
  "name": "travel-planner-frontend",
  "version": "1.0.0",
  "description": "旅游助手前端应用",
  "private": true,
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "dependencies": {
    "@ant-design/icons": "^5.2.6",
    "@mui/icons-material": "^7.3.4",
    "@mui/material": "^7.3.4",
    "antd": "^5.12.8",
    "axios": "^1.6.2",
    "dayjs": "^1.11.10",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.1",
    "react-scripts": "5.0.1",
    "recharts": "^3.3.0",
    "typescript": "^4.9.5",
    "web-vitals": "^3.5.0"
  },
  "devDependencies": {
    "@types/jest": "^29.5.8",
    "@types/node": "^20.10.0",
    "@types/react": "^18.2.42",
    "@types/react-dom": "^18.2.17"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```

## 5. Docker配置

### 5.1 后端Dockerfile
```dockerfile
FROM openjdk:8-jdk-alpine

WORKDIR /app

# 复制Maven配置文件
COPY pom.xml .
COPY .mvn .mvn
COPY mvnw .

# 下载依赖
RUN ./mvnw dependency:go-offline -B

# 复制源代码
COPY src src

# 构建应用
RUN ./mvnw clean package -DskipTests

# 运行应用
EXPOSE 8080
CMD ["java", "-jar", "target/travel-planner-1.0.0.jar"]
```

### 5.2 前端Dockerfile
```dockerfile
FROM node:18-alpine as builder

WORKDIR /app

# 复制package文件
COPY package*.json ./

# 安装依赖
RUN npm ci --only=production

# 复制源代码
COPY . .

# 构建应用
RUN npm run build

# 生产环境
FROM nginx:alpine

# 复制构建结果
COPY --from=builder /app/build /usr/share/nginx/html

# 复制nginx配置
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### 5.3 docker-compose.yml
```yaml
version: '3.8'

services:
  travel-planner:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    volumes:
      # 持久化H2数据库文件（如果使用文件模式）
      - ./backend/data:/app/data
    environment:
      - SPRING_PROFILES_ACTIVE=default
      - JWT_SECRET=${JWT_SECRET:-travelplanner-secret-key-2024}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

## 6. GitHub Actions配置

### 6.1 .github/workflows/docker-build.yml
```yaml
name: Build and Push Docker Images

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
      
      - name: Build backend
        run: |
          cd backend
          ./mvnw clean package -DskipTests
      
      - name: Build Docker image
        run: |
          cd backend
          docker build -t travelplanner-backend:${{ github.sha }} .
      
      - name: Push to Aliyun Registry
        run: |
          docker tag travelplanner-backend:${{ github.sha }} registry.cn-hangzhou.aliyuncs.com/your-namespace/travelplanner-backend:${{ github.sha }}
          docker push registry.cn-hangzhou.aliyuncs.com/your-namespace/travelplanner-backend:${{ github.sha }}

  build-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Install dependencies
        run: |
          cd frontend
          npm ci
      
      - name: Build frontend
        run: |
          cd frontend
          npm run build
      
      - name: Build Docker image
        run: |
          cd frontend
          docker build -t travelplanner-frontend:${{ github.sha }} .
      
      - name: Push to Aliyun Registry
        run: |
          docker tag travelplanner-frontend:${{ github.sha }} registry.cn-hangzhou.aliyuncs.com/your-namespace/travelplanner-frontend:${{ github.sha }}
          docker push registry.cn-hangzhou.aliyuncs.com/your-namespace/travelplanner-frontend:${{ github.sha }}
```

## 7. 环境变量配置

### 7.1 .env.example (前端)
```env
# API配置
VITE_API_BASE_URL=http://localhost:8080/api
VITE_BAIDU_API_KEY=your_baidu_api_key

# 其他配置
VITE_APP_TITLE=旅游助手
VITE_APP_VERSION=1.0.0
```

### 7.2 .env.example (后端)
```env
# 数据库配置
DB_USERNAME=travelplanner
DB_PASSWORD=password
DB_HOST=localhost
DB_PORT=5432

# Redis配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# JWT配置
JWT_SECRET=your-jwt-secret-key

# 第三方服务配置
XUNFEI_APP_ID=your_xunfei_app_id
XUNFEI_API_KEY=your_xunfei_api_key
XUNFEI_API_SECRET=your_xunfei_api_secret

BAIDU_API_KEY=your_baidu_api_key

# 通义千问配置
QWEN_API_KEY=your_qwen_api_key
QWEN_API_URL=https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
```

## 8. 开发环境启动脚本

### 8.1 scripts/start-dev.sh
```bash
#!/bin/bash

echo "启动开发环境..."

# 启动数据库
docker-compose up -d postgres

# 等待数据库启动
sleep 10

# 启动后端
cd backend
./mvnw spring-boot:run &
BACKEND_PID=$!

# 启动前端
cd ../frontend
npm run dev &
FRONTEND_PID=$!

echo "开发环境已启动"
echo "前端: http://localhost:3000"
echo "后端: http://localhost:8080"
echo "数据库: localhost:5432"

# 等待用户中断
wait $BACKEND_PID $FRONTEND_PID
```

### 8.2 scripts/build.sh
```bash
#!/bin/bash

echo "构建项目..."

# 构建后端
cd backend
./mvnw clean package -DskipTests
cd ..

# 构建前端
cd frontend
npm run build
cd ..

echo "构建完成"
```

这个项目架构设计充分考虑了您的要求：
1. 使用Spring Boot作为后端框架
2. 前后端分离的架构
3. 完整的Docker化部署方案
4. GitHub Actions自动化构建
5. 清晰的目录结构和配置管理
6. 支持API密钥的安全配置

接下来我可以帮您生成具体的API接口规范和数据库设计文档。
