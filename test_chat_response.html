<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试聊天响应</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .response { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .field { background: #e6f7ff; padding: 5px; margin: 5px 0; border-radius: 3px; }
        button { padding: 10px 20px; margin: 5px; background: #1890ff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #40a9ff; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>测试聊天响应数据</h1>
    
    <div class="test-section">
        <h3>1. 发送测试消息</h3>
        <textarea id="testMessage" placeholder="输入测试消息，如：我想去北京旅游，预算5000元，3个人，休闲游">我想去北京旅游，预算5000元，3个人，休闲游</textarea>
        <br>
        <button onclick="testChat()">发送消息</button>
    </div>
    
    <div class="test-section">
        <h3>2. 原始API响应</h3>
        <div id="rawResponse" class="response">等待响应...</div>
    </div>
    
    <div class="test-section">
        <h3>3. 解析后的数据</h3>
        <div id="parsedData" class="response">等待解析...</div>
    </div>
    
    <div class="test-section">
        <h3>4. 提取的字段</h3>
        <div id="extractedFields" class="response">等待提取...</div>
    </div>

    <script>
        async function testChat() {
            const message = document.getElementById('testMessage').value;
            if (!message.trim()) {
                alert('请输入测试消息');
                return;
            }
            
            try {
                console.log('发送消息:', message);
                
                const response = await fetch('http://localhost:8080/conversations/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: 1, // 假设用户ID为1
                        message: message
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API响应:', data);
                
                // 显示原始响应
                document.getElementById('rawResponse').innerHTML = 
                    '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                // 显示解析后的数据
                const parsedInfo = {
                    message: data.message,
                    messageLength: data.message ? data.message.length : 0,
                    processingTime: data.processingTime,
                    timestamp: data.timestamp,
                    hasExtractedFields: !!data.extractedFields,
                    extractedFieldsType: typeof data.extractedFields
                };
                
                document.getElementById('parsedData').innerHTML = 
                    '<pre>' + JSON.stringify(parsedInfo, null, 2) + '</pre>';
                
                // 显示提取的字段
                if (data.extractedFields) {
                    const fieldsHtml = Object.entries(data.extractedFields)
                        .map(([key, value]) => 
                            `<div class="field"><strong>${key}:</strong> ${value || 'null'}</div>`
                        ).join('');
                    
                    document.getElementById('extractedFields').innerHTML = fieldsHtml;
                } else {
                    document.getElementById('extractedFields').innerHTML = 
                        '<div style="color: red;">❌ 没有提取的字段</div>';
                }
                
            } catch (error) {
                console.error('测试失败:', error);
                document.getElementById('rawResponse').innerHTML = 
                    '<div style="color: red;">❌ 请求失败: ' + error.message + '</div>';
            }
        }
        
        // 页面加载时自动测试
        window.onload = function() {
            console.log('页面加载完成，可以开始测试');
        };
    </script>
</body>
</html>
