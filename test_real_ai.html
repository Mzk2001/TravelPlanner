<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•çœŸå®é€šä¹‰åƒé—®APIè°ƒç”¨</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .ai-response { background: #fff3cd; color: #856404; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>æµ‹è¯•çœŸå®é€šä¹‰åƒé—®APIè°ƒç”¨</h1>
    
    <div class="test-section">
        <h3>ğŸ”§ é…ç½®ä¿¡æ¯</h3>
        <div class="info">
            <strong>å½“å‰çŠ¶æ€ï¼š</strong>å·²ç¦ç”¨æ¡©ç¨‹åºæ¨¡å¼ï¼Œå¯ç”¨çœŸå®é€šä¹‰åƒé—®APIè°ƒç”¨<br>
            <strong>API Keyï¼š</strong>sk-cc0831e2c3d045ccb72a4c75ad234333<br>
            <strong>APIç«¯ç‚¹ï¼š</strong>https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation<br>
            <strong>æ¨¡å‹ï¼š</strong>qwen-turbo
        </div>
    </div>
    
    <div class="test-section">
        <h3>1. æµ‹è¯•AIå¯¹è¯åŠŸèƒ½</h3>
        <button onclick="testAiChat()">æµ‹è¯•AIå¯¹è¯</button>
        <div id="chatResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. æµ‹è¯•æ—…æ¸¸è®¡åˆ’ç”Ÿæˆ</h3>
        <button onclick="testTravelPlan()">ç”ŸæˆåŒ—äº¬3æ—¥æ¸¸è®¡åˆ’</button>
        <div id="planResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. æµ‹è¯•é¢„ç®—åˆ†æ</h3>
        <button onclick="testBudgetAnalysis()">æµ‹è¯•é¢„ç®—åˆ†æ</button>
        <div id="budgetResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. æµ‹è¯•API KeyéªŒè¯</h3>
        <button onclick="testApiKey()">éªŒè¯API Key</button>
        <div id="apiKeyResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        const TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMTEiLCJpYXQiOjE3MzIzMjQ5NzIsImV4cCI6MTczMjQxMTM3Mn0.8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8';
        
        async function testAiChat() {
            const resultDiv = document.getElementById('chatResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•AIå¯¹è¯åŠŸèƒ½...';
            
            try {
                const response = await fetch(`${API_BASE}/conversations/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TOKEN}`
                    },
                    body: JSON.stringify({
                        userId: 3,
                        userMessage: 'è¯·å¸®æˆ‘åˆ¶å®šä¸€ä¸ªä¸Šæµ·2æ—¥æ¸¸çš„æ—…è¡Œè®¡åˆ’ï¼Œé¢„ç®—5000å…ƒ',
                        messageType: 'TEXT'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">AIå¯¹è¯æµ‹è¯•æˆåŠŸï¼</div>`;
                    resultDiv.innerHTML += `<div class="ai-response"><strong>AIå›å¤ï¼š</strong><br>${data.aiResponse}</div>`;
                    resultDiv.innerHTML += `<div class="info">å¤„ç†æ—¶é—´ï¼š${data.processingTime}ms</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">AIå¯¹è¯æµ‹è¯•å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testTravelPlan() {
            const resultDiv = document.getElementById('planResult');
            resultDiv.innerHTML = 'æ­£åœ¨ç”Ÿæˆæ—…æ¸¸è®¡åˆ’...';
            
            try {
                const response = await fetch(`${API_BASE}/conversations/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TOKEN}`
                    },
                    body: JSON.stringify({
                        userId: 3,
                        userMessage: 'è¯·å¸®æˆ‘åˆ¶å®šä¸€ä¸ªåŒ—äº¬3æ—¥æ¸¸çš„è¯¦ç»†æ—…è¡Œè®¡åˆ’ï¼ŒåŒ…å«æ™¯ç‚¹ã€ç¾é£Ÿã€ä½å®¿å’Œäº¤é€šå®‰æ’',
                        messageType: 'TEXT'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">æ—…æ¸¸è®¡åˆ’ç”ŸæˆæˆåŠŸï¼</div>`;
                    resultDiv.innerHTML += `<div class="ai-response"><strong>AIç”Ÿæˆçš„è®¡åˆ’ï¼š</strong><br>${data.aiResponse}</div>`;
                    resultDiv.innerHTML += `<div class="info">å¤„ç†æ—¶é—´ï¼š${data.processingTime}ms</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">æ—…æ¸¸è®¡åˆ’ç”Ÿæˆå¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testBudgetAnalysis() {
            const resultDiv = document.getElementById('budgetResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•é¢„ç®—åˆ†æ...';
            
            try {
                // å…ˆåˆ›å»ºä¸€ä¸ªè®¡åˆ’
                const planResponse = await fetch(`${API_BASE}/plans`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TOKEN}`
                    },
                    body: JSON.stringify({
                        userId: 3,
                        planName: 'æµ‹è¯•é¢„ç®—åˆ†æè®¡åˆ’',
                        destination: 'åŒ—äº¬',
                        startDate: '2024-01-01T00:00:00',
                        endDate: '2024-01-03T00:00:00',
                        budget: 5000,
                        travelType: 'ä¼‘é—²',
                        groupSize: 2,
                        specialRequirements: 'æµ‹è¯•ç‰¹æ®Šéœ€æ±‚'
                    })
                });
                
                const planData = await planResponse.json();
                
                if (planResponse.ok) {
                    resultDiv.innerHTML = `<div class="success">è®¡åˆ’åˆ›å»ºæˆåŠŸï¼ŒID: ${planData.id}</div>`;
                    
                    // æµ‹è¯•é¢„ç®—åˆ†æ
                    const analysisResponse = await fetch(`${API_BASE}/ai/budget-analysis`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${TOKEN}`
                        },
                        body: JSON.stringify({
                            planId: planData.id,
                            budgetData: {
                                totalBudget: 5000,
                                remainingBudget: 3000
                            },
                            expenseData: {
                                totalExpense: 2000,
                                budgetUtilization: 40,
                                categoryBreakdown: {
                                    'äº¤é€š': 800,
                                    'ä½å®¿': 600,
                                    'é¤é¥®': 400,
                                    'é—¨ç¥¨': 200
                                }
                            }
                        })
                    });
                    
                    const analysisData = await analysisResponse.json();
                    
                    if (analysisResponse.ok) {
                        resultDiv.innerHTML += `<div class="success">é¢„ç®—åˆ†ææµ‹è¯•æˆåŠŸï¼</div>`;
                        resultDiv.innerHTML += `<div class="ai-response"><strong>AIåˆ†æç»“æœï¼š</strong><br>${analysisData}</div>`;
                    } else {
                        resultDiv.innerHTML += `<div class="error">é¢„ç®—åˆ†æå¤±è´¥ï¼š${analysisData.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error">è®¡åˆ’åˆ›å»ºå¤±è´¥ï¼š${planData.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testApiKey() {
            const resultDiv = document.getElementById('apiKeyResult');
            resultDiv.innerHTML = 'æ­£åœ¨éªŒè¯API Key...';
            
            try {
                const response = await fetch(`${API_BASE}/ai/test`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">API KeyéªŒè¯æˆåŠŸï¼</div>`;
                    resultDiv.innerHTML += `<div class="info">${data.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">API KeyéªŒè¯å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">éªŒè¯å¤±è´¥: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
